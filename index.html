<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday! üéâ</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Indie+Flower&family=Permanent+Marker&family=Patrick+Hand&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --paper-color: #fdfbf7;
            --bg-color: #f3e5d8;
            --accent-color: #e53e3e;
            --text-color: #2d3748;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            overflow: hidden;
            font-family: 'Indie Flower', cursive;
            user-select: none;
            height: 100vh; width: 100vw;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- BACKGROUND --- */
        #bg-doodle-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.6;
        }
        .bg-doodle {
            position: absolute; opacity: 0.8;
            filter: sepia(0.3) contrast(0.9);
        }

        /* --- DESK VIEW --- */
        #desk {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            perspective: 1500px;
            transition: opacity 0.5s ease, transform 0.5s ease;
            z-index: 10;
        }
        #desk.inactive {
            opacity: 0; pointer-events: none;
            transform: scale(0.90) translateY(50px);
        }

        .card-container {
            position: absolute; width: 220px; height: 260px;
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
            touch-action: none;
            animation: float 6s ease-in-out infinite;
        }
        .card-container:active { cursor: grabbing; animation: none; }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotateX(0deg) rotateY(4deg); }
            50% { transform: translateY(-15px) rotateX(2deg) rotateY(-4deg); }
        }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }
        .card-container.flipped .card-inner { transform: rotateY(180deg); }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px;
            background-color: var(--paper-color);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            display: flex; justify-content: center; align-items: center;
        }
        .card-front { padding: 10px; box-sizing: border-box; }
        .photo-frame {
            width: 100%; height: 100%; background-color: #f0f0f0;
            overflow: hidden; border-radius: 8px;
        }
        .photo-frame img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            padding: 20px;
        }
        .handwritten-note {
            font-family: 'Caveat', cursive; font-size: 1.8rem;
            color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            line-height: 1.2;
        }
        .tape {
            position: absolute; height: 35px; width: 100px;
            top: -15px; left: 50%; transform: translateX(-50%) rotate(-3deg);
            background-color: rgba(255,255,255,0.3); backdrop-filter: blur(4px);
            z-index: 5; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* --- JOURNEY VIEW --- */
        #journey-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 50; opacity: 0; pointer-events: none;
            transition: opacity 0.6s ease;
            background-color: #fdfbf7;
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
        }
        #journey-view.active { opacity: 1; pointer-events: auto; }

        .map-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow: auto; scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .map-container::-webkit-scrollbar { display: none; }

        .map-canvas {
            position: relative;
            min-width: 100vw; min-height: 100vh;
            width: 1500px; height: 1200px; 
            display: flex; align-items: center; justify-content: center;
        }

        /* SVG Path Layer */
        svg.path-svg {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 900px; height: 800px; /* ViewBox Size */
            overflow: visible; z-index: 51;
        }
        path#walk-path {
            fill: none; stroke: #cbd5e0; stroke-width: 8;
            stroke-dasharray: 20, 15; stroke-linecap: round; stroke-linejoin: round;
        }

        /* Character */
        #character-token {
            position: absolute; width: 90px; height: 90px;
            z-index: 60; pointer-events: none;
            transition: top 4s linear, left 4s linear;
        }
        #character-token img {
            width: 100%; height: 100%; object-fit: contain;
            filter: drop-shadow(0 8px 15px rgba(0,0,0,0.3));
        }

        /* Milestones */
        .milestone-dot {
            position: absolute; width: 20px; height: 20px;
            background: var(--accent-color); border-radius: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 52;
        }

        /* --- STORY BUBBLE --- */
        #story-bubble {
            position: absolute;
            width: 300px; max-width: 90vw;
            background: white; padding: 16px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            font-family: 'Patrick Hand', cursive;
            z-index: 70; text-align: center;
            opacity: 0; pointer-events: none;
            transform: translate(-50%, -80%) scale(0.9);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: bottom center;
        }
        #story-bubble.visible {
            opacity: 1; pointer-events: auto;
            transform: translate(-50%, -100%) scale(1);
        }
        #story-bubble::after {
            content: ''; position: absolute;
            bottom: -10px; left: 50%; transform: translateX(-50%);
            border-width: 10px 10px 0; border-style: solid;
            border-color: white transparent transparent transparent;
        }
        #story-bubble img {
            width: 100%; max-height: 200px; object-fit: cover;
            border-radius: 8px; margin-bottom: 10px;
        }
        #story-content {
            font-size: 1.1rem; color: var(--text-color);
            line-height: 1.4; margin-bottom: 12px;
        }
        .bubble-nav {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 10px; padding-top: 10px; border-top: 2px dashed #eee;
        }
        .nav-btn {
            background: var(--accent-color); color: white;
            border: none; padding: 8px 16px; border-radius: 20px;
            font-family: 'Permanent Marker', cursive; cursor: pointer;
        }
        .nav-btn:disabled { background: #cbd5e0; cursor: default; }

        /* --- UI OVERLAY --- */
        .ui-layer {
            position: fixed; z-index: 100; width: 100%; height: 100%;
            pointer-events: none;
        }
        .header-title {
            position: absolute; top: 20px; left: 20px;
            font-family: 'Permanent Marker', cursive; font-size: 3rem;
            color: var(--accent-color); text-shadow: 3px 3px 0px #fff;
            pointer-events: auto;
        }
        .toggle-btn-container {
            position: absolute; bottom: 30px; width: 100%;
            display: flex; justify-content: center; pointer-events: auto;
        }
        .toggle-btn {
            background: white; border: 3px solid var(--accent-color);
            color: var(--accent-color); padding: 12px 35px;
            border-radius: 50px; font-family: 'Permanent Marker', cursive;
            font-size: 1.3rem; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        .toggle-btn:hover { transform: translateY(-3px); background: var(--accent-color); color: white; }
        .instructions {
            position: absolute; bottom: 100px; width: 100%;
            text-align: center; opacity: 0.8; font-size: 1.1rem;
            text-shadow: 0 1px 2px white; transition: opacity 0.3s;
        }

        /* --- MOBILE TWEAKS --- */
        @media (max-width: 600px) {
            .header-title { font-size: 2rem; top: 15px; left: 15px; }
            .card-container { width: 150px; height: 190px; }
            .toggle-btn { padding: 10px 25px; font-size: 1.1rem; }
            #story-bubble { width: 85vw; padding: 12px; }
            #story-bubble img { max-height: 150px; }
            #story-content { font-size: 0.95rem; }
            .map-canvas { width: 1200px; height: 1000px; }
            svg.path-svg { width: 800px; height: 700px; }
        }
    </style>
</head>
<body>

    <div id="bg-doodle-layer"></div>

    <div class="ui-layer">
        <div class="header-title">Happy Birthday!</div>
        <div class="instructions" id="desk-instr">‚ú® Drag photos ‚Ä¢ Double-click to flip ‚ú®</div>
        <div class="toggle-btn-container">
            <button class="toggle-btn" onclick="toggleView()" id="main-btn">Start Journey üó∫Ô∏è</button>
        </div>
    </div>

    <div id="desk"></div>

    <div id="journey-view">
        <div class="map-container" id="map-container">
            <div class="map-canvas">
                <svg class="path-svg" viewBox="0 0 900 800" preserveAspectRatio="xMidYMid meet">
                    <path id="walk-path" d="M 50 500 C 200 300, 300 700, 400 500 S 650 300, 750 500
" />
                </svg>
                
                <div id="milestones-layer"></div>

                <div id="character-token">
                    <img src="387bb40f63c548a1923f4d721c6e1e48[1].png" alt="Character">
                </div>

                <div id="story-bubble">
                    <img id="bubble-img" src="" alt="Memory">
                    <div id="story-content"></div>
                    <div class="bubble-nav">
                        <button class="nav-btn" id="btn-prev" onclick="moveStep(-1)">‚ùÆ</button>
                        <span class="step-counter" id="step-count">1 / 5</span>
                        <button class="nav-btn" id="btn-next" onclick="moveStep(1)">‚ùØ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const memories = [
            { img: "1.png", note: "HARRY KI DIWALI" },
            { img: "2.png", note: "K-DRAMA SPOILER" },
            { img: "3.png", note: "MEMORIES..." },
            { img: "4.png", note: "SMILES" },
            { img: "5.png", note: "FUN TIMES" },
            { img: "6.png", note: "CELEBRATION" }
        ];

        const journeyData = [
             { img: "sfs.jpg", text: "Baat thi dasvi board ke pahale ki,<br>Chal rahi thi hawa Snapchat use karne ki,<br>Phir dikhi ek story uss din,<br>Likha hua 'SFS' ek pic ke saath of malkin,<br>Galti se gayi request accept ussi din,<br>Magar dhyaan bhi nahi diya itna‚Ä¶<br>Kaun jaanta tha badalne wala hai kuch agla din?"},
             { img: "sanskrit.png", text: "Phir ek din‚Ä¶!<br>Dikhi Sanskrit ki woh kitaab,<br>Maine bola, ‚ÄúAree bhaishaab,<br>Kuch toh baat hai sahab‚Ä¶<br>Kahin hum dono ke hi same hi khwaab!?"},
             { img: "call.png", text: "Phir toh jo hui baate,<br>Har din y≈© baithe jaate dono nawabjaade,<br>Haan, beech-beech me band ho gayi bahut baar,<br>Magar jab hoti thi, toh khul jaati thi kitaabe‚Ä¶!"},
             { img: "ghibli.jpg", text: "Ab jab dooriyaan aayi hain,<br>Dono ke hi jeevan me badlaav laayiii hain,<br>Ho sakta hai na ho pehle waali baat ab,<br>Magar duniya hi aisi hai,<br>Jab zarurat ho‚Ä¶ Bhagwan ne mulaqat karwaayi hai..!"},
             { img: "bye.png", text: "Happy Birthday, Nivi‚Ä¶<br>Har baar aaj mere shabd ye gayenge,<br>Aasha hai ek din Bhagwan khud mulaqat karwaayenge.<br>Maaf kar dena‚Ä¶ main hoon hi aisa,<br>Na jaane ye aadat meri<br>Kitne rishte ab aur tudwaayegi‚Ä¶"}
        ];

        const doodles = [
            "https://img.icons8.com/doodle/96/wizard-hat.png",
            "https://img.icons8.com/doodle/96/magic-wand.png",
            "https://img.icons8.com/doodle/96/south-korea.png",
            "https://img.icons8.com/doodle/96/noodles.png",
            "https://img.icons8.com/doodle/96/sailing-ship-large.png"
        ];

        let currentStep = 0;
        let isJourneyActive = false;
        let highestZ = 20;

        window.onload = () => {
            initBackground();
            initDesk();
            initJourneyMap();
            setTimeout(doConfetti, 1000);
        };

        function initBackground() {
            const container = document.getElementById('bg-doodle-layer');
            for(let i=0; i<20; i++) {
                const img = document.createElement('img');
                img.src = doodles[i % doodles.length];
                img.className = 'bg-doodle';
                img.style.left = Math.random()*100 + 'vw';
                img.style.top = Math.random()*100 + 'vh';
                img.style.transform = `rotate(${Math.random()*360}deg)`;
                img.style.width = (40 + Math.random()*40) + 'px';
                container.appendChild(img);
            }
        }

        function initDesk() {
            const desk = document.getElementById('desk');
            memories.forEach((mem, i) => {
                const card = document.createElement('div');
                card.className = 'card-container';
                const isMobile = window.innerWidth < 600;
                let x, y, rot;
                if(isMobile) {
                    const col = i % 2;
                    const row = Math.floor(i / 2);
                    x = 20 + col * 170; y = 100 + row * 210;
                    rot = Math.random()*10 - 5;
                } else {
                    x = (window.innerWidth/2 - 110) + (Math.random()*300 - 150);
                    y = (window.innerHeight/2 - 130) + (Math.random()*200 - 100);
                    rot = Math.random()*30 - 15;
                }
                card.style.left = x + 'px'; card.style.top = y + 'px';
                card.style.transform = `rotate(${rot}deg)`; card.style.zIndex = i + 1;
                card.innerHTML = `
                    <div class="tape"></div>
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="photo-frame"><img src="${mem.img}" draggable="false"></div>
                        </div>
                        <div class="card-back">
                            <div class="handwritten-note">${mem.note}</div>
                        </div>
                    </div>`;
                card.addEventListener('mousedown', () => card.style.zIndex = ++highestZ);
                card.addEventListener('touchstart', () => card.style.zIndex = ++highestZ);
                card.addEventListener('dblclick', () => { card.classList.toggle('flipped'); doMiniConfetti(card); });
                makeDraggable(card);
                desk.appendChild(card);
            });
        }

        function makeDraggable(el) {
            let isDragging = false, startX, startY, initialLeft, initialTop;
            const start = (cx, cy) => {
                isDragging = true; startX = cx; startY = cy;
                initialLeft = el.offsetLeft; initialTop = el.offsetTop;
                el.style.transition = 'none'; el.style.cursor = 'grabbing';
            };
            const move = (cx, cy) => {
                if(!isDragging) return;
                el.style.left = (initialLeft + (cx - startX)) + 'px';
                el.style.top = (initialTop + (cy - startY)) + 'px';
            };
            const end = () => { isDragging = false; el.style.transition = 'transform 0.1s'; el.style.cursor = 'grab'; };
            el.addEventListener('mousedown', e => start(e.clientX, e.clientY));
            window.addEventListener('mousemove', e => move(e.clientX, e.clientY));
            window.addEventListener('mouseup', end);
            el.addEventListener('touchstart', e => start(e.touches[0].clientX, e.touches[0].clientY));
            window.addEventListener('touchmove', e => { if(isDragging) e.preventDefault(); move(e.touches[0].clientX, e.touches[0].clientY); }, {passive:false});
            window.addEventListener('touchend', end);
        }

        function toggleView() {
            const desk = document.getElementById('desk');
            const journey = document.getElementById('journey-view');
            const btn = document.getElementById('main-btn');
            const instr = document.getElementById('desk-instr');
            isJourneyActive = !isJourneyActive;
            if(isJourneyActive) {
                desk.classList.add('inactive');
                journey.classList.add('active');
                btn.innerText = "Back to Scrapbook üì∏";
                instr.style.opacity = 0;
                updateJourneyState(currentStep);
            } else {
                desk.classList.remove('inactive');
                journey.classList.remove('active');
                btn.innerText = "Start Journey üó∫Ô∏è";
                instr.style.opacity = 1;
            }
        }

        function initJourneyMap() {
            const path = document.getElementById('walk-path');
            const layer = document.getElementById('milestones-layer');
            const len = path.getTotalLength();
            const canvas = document.querySelector('.map-canvas');
            
            // Adjust offsets based on the SVG viewBox size (900x800)
            const offsetX = 450; 
            const offsetY = 400;

            journeyData.forEach((_, idx) => {
                const pt = path.getPointAtLength((idx / (journeyData.length - 1)) * len);
                const dot = document.createElement('div');
                dot.className = 'milestone-dot';
                dot.style.left = `calc(50% - ${offsetX}px + ${pt.x}px)`;
                dot.style.top = `calc(50% - ${offsetY}px + ${pt.y}px)`;
                canvas.appendChild(dot);
            });
        }

        function moveStep(dir) {
            const next = currentStep + dir;
            if(next >= 0 && next < journeyData.length) {
                currentStep = next;
                updateJourneyState(currentStep);
            }
        }

        function updateJourneyState(index) {
            const path = document.getElementById('walk-path');
            const token = document.getElementById('character-token');
            const bubble = document.getElementById('story-bubble');
            const mapContainer = document.getElementById('map-container');
            const canvas = document.querySelector('.map-canvas');

            const len = path.getTotalLength();
            const pt = path.getPointAtLength((index / (journeyData.length - 1)) * len);
            
            const offsetX = 450; 
            const offsetY = 400;

            const xPos = `calc(50% - ${offsetX}px + ${pt.x}px)`;
            const yPos = `calc(50% - ${offsetY}px + ${pt.y}px)`;
            
            token.style.left = xPos;
            token.style.top = yPos;

            bubble.classList.remove('visible');

            // --- AUTO SCROLL ---
            setTimeout(() => {
                const canvasW = canvas.offsetWidth;
                const canvasH = canvas.offsetHeight;
                const centerX = canvasW / 2;
                const centerY = canvasH / 2;
                const charRelX = pt.x - offsetX;
                const charRelY = pt.y - offsetY;
                const charAbsX = centerX + charRelX;
                const charAbsY = centerY + charRelY;

                // Center camera slightly ABOVE character
                const targetY = charAbsY - 150; 

                const viewportW = mapContainer.clientWidth;
                const viewportH = mapContainer.clientHeight;

                mapContainer.scrollTo({
                    left: charAbsX - (viewportW / 2),
                    top: targetY - (viewportH / 2),
                    behavior: 'smooth'
                });
            }, 100);

            setTimeout(() => {
                // Position Bubble 70px above character
                bubble.style.left = xPos;
                bubble.style.top = `calc(${yPos} - 70px)`; 
                
                const data = journeyData[index];
                document.getElementById('bubble-img').src = data.img;
                document.getElementById('story-content').innerHTML = data.text;
                document.getElementById('step-count').innerText = `${index + 1} / ${journeyData.length}`;
                document.getElementById('btn-prev').disabled = (index === 0);
                document.getElementById('btn-next').disabled = (index === journeyData.length - 1);
                
                bubble.classList.add('visible');
            }, 3000);
        }

        function doConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }
        function doMiniConfetti(el) {
            const rect = el.getBoundingClientRect();
            const x = (rect.left + rect.width/2) / window.innerWidth;
            const y = (rect.top + rect.height/2) / window.innerHeight;
            confetti({ particleCount: 30, spread: 50, origin: { x, y }, ticks: 60, zIndex: 999 });
        }
    </script>
</body>
</html>